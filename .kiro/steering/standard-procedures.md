# 標準手順の遵守

## 基本原則

**Kiro AIは、独自の判断で手順を変更せず、ステアリングファイルやドキュメントに記載された標準手順に厳密に従うこと**

## ルール

### 1. 標準手順の優先

- ステアリングファイルに記載された手順が存在する場合、必ずその手順に従う
- Makefile、README、ドキュメントに記載された手順を優先する
- 独自の判断で「より良い方法」を試さない

### 2. エラーが発生した場合

エラーが発生した場合の対応順序：

1. **まず標準手順を確認する**
   - ステアリングファイルを再確認
   - Makefileやドキュメントを再確認
   - 手順を正しく実行したか確認

2. **標準手順にエラーがある場合**
   - エラーの原因を特定
   - 標準手順（Makefile、ステアリングファイル、ドキュメント）を修正
   - 修正後、再度標準手順に従って実行

3. **独自の回避策を取らない**
   - ❌ 悪い例: 「Makefileがエラーになるので、直接コマンドを実行します」
   - ✅ 良い例: 「Makefileにエラーがあるので、まずMakefileを修正します」

### 3. デプロイ・ビルド手順

#### 必須の確認事項

デプロイやビルドを実行する前に、以下を確認すること：

- [ ] ステアリングファイルに手順が記載されているか確認
- [ ] Makefileに該当するターゲットがあるか確認
- [ ] READMEやドキュメントに手順が記載されているか確認

#### 実行順序

1. **ステアリングファイルの手順を確認**
   - `.kiro/steering/` 配下のファイルを確認
   - 該当する手順が記載されているか確認

2. **Makefileの手順を確認**
   - `make help` でターゲット一覧を確認
   - 該当するターゲットを実行

3. **エラーが発生した場合**
   - エラーメッセージを確認
   - 標準手順（Makefile、ステアリングファイル）を修正
   - 修正後、再度標準手順に従って実行

### 4. 禁止事項

以下の行動は禁止：

- ❌ ステアリングファイルやMakefileを無視して独自の手順を実行
- ❌ エラーが発生したときに、標準手順を修正せずに回避策を実行
- ❌ 「より良い方法」として独自のスクリプトやコマンドを実行
- ❌ ユーザーに「手動で実行してください」と依頼（標準手順を修正すべき）

### 5. 許容される例外

以下の場合のみ、独自の判断が許容される：

1. **デバッグ目的**
   - エラーの原因を特定するための調査
   - ただし、調査後は標準手順を修正すること

2. **緊急の本番障害**
   - 即座の対応が必要な場合
   - ただし、後日必ず標準手順を修正すること

3. **ステアリングファイルに手順が存在しない場合**
   - 新しい機能や操作の場合
   - ただし、実行後は標準手順をステアリングファイルに追加すること

## 実践例

### ❌ 悪い例

```
ユーザー: exampleプロジェクトをデプロイして

AI: Makefileにエラーがあるので、直接Terraformコマンドを実行します。
    terraform apply -auto-approve
```

**問題点**: Makefileのエラーを修正せずに、独自の手順を実行している

### ✅ 良い例

```
ユーザー: exampleプロジェクトをデプロイして

AI: まず、Makefileの手順を確認します。
    make deploy-dev を実行します。
    
    エラーが発生しました: generate-shadow-config コマンドが見つかりません
    
    原因: v0.3.5では generate-shadow-config が不要になりましたが、
          Makefileが更新されていません。
    
    対応: Makefileを修正して、generate-shadow-config の呼び出しを削除します。
    
    修正後、再度 make deploy-dev を実行します。
```

**良い点**: エラーの原因を特定し、標準手順（Makefile）を修正してから再実行している

## チェックリスト

作業を実行する前に、以下を確認すること：

- [ ] ステアリングファイルに該当する手順が記載されているか確認した
- [ ] Makefileに該当するターゲットがあるか確認した
- [ ] 標準手順に従って実行する予定である
- [ ] エラーが発生した場合、標準手順を修正する予定である
- [ ] 独自の回避策を取らない予定である

## 参考

- [makefile-operations.md](.kiro/steering/makefile-operations.md) - Makefile運用ガイドライン
- [terraform.md](.kiro/steering/terraform.md) - Terraform操作ガイドライン
- [npm-publishing.md](.kiro/steering/npm-publishing.md) - npmパブリッシュガイドライン
